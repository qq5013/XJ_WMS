<?xml version="1.0" encoding="utf-8" ?>
<SqlCommand>
  <!--入库单据 -->
  <Command ID="SelectBillMaster">
    <CommandString>
      select main.*,area.AreaName,billtype.BillTypeName,TrainType.TypeName,Facotry.FactoryName,State.StateDesc
      from WMS_BillMaster main
      left join CMD_BillType BillType on main.BillTypeCode=BillType.BillTypeCode
      left join CMD_TrainType TrainType on main.TrainTypeCode=TrainType.TypeCode
      left join CMD_Area area on main.AreaCode=area.AreaCode
      left join CMD_Factory Facotry on main.FactoryID=Facotry.FactoryID
      left join Sys_TableState State on State.State=main.State and State.TableName='WMS_BillMaster' and State.FieldName='State'
      where {0}
      ORDER BY BillDate DESC, Main.BillID DESC
    </CommandString>
  </Command>
  <Command ID="DeleteBillMaster">
    <CommandString>
      delete from WMS_BillMaster where BillID in ({0})
    </CommandString>
  </Command>
  
  <Command ID="SelectBillDetail">
    <CommandString>
      select detail.*,product.ProductName from WMS_BillDetail detail
      inner join CMD_Product product on detail.ProductCode=product.ProductCode
      where {0}
      ORDER BY RowID
    </CommandString>
  </Command>
  <Command ID="SelectBillTask">
    <CommandString>
      select task.*,Product.ProductName,state.StateDesc from WCS_TASK Task
      inner join CMD_Product Product on task.ProductCode=Product.ProductCode
      inner join Sys_TableState state on task.State=state.State and state.TableName='WCS_task' and state.FieldName='State'
      where {0}
      order by taskNo
    </CommandString>
  </Command>
  <Command ID="UpdateCheckBillMaster">
    <CommandString>
      update WMS_BillMaster set Checker=@Checker,CheckDate={0},State=@State where BillID=@BillID
    </CommandString>
  </Command>
  
  <Command ID="DeleteBillDetail">
    <CommandString>
      delete from  WMS_BillDetail where {0}
    </CommandString>
  </Command>
  

  <!--入库单-->
  <Command ID="InsertInStockBill">
    <CommandString>
      insert into WMS_BillMaster(BillID,BillDate,AreaCode,BillTypeCode,FactoryID,Memo,Creator,CreateDate,Updater,UpdateDate)
      values(@BillID,@BillDate,@AreaCode,@BillTypeCode,@FactoryID,@Memo,@Creator,GETDATE(),@Updater,GETDATE())
    </CommandString>
  </Command>
  <Command ID="UpdateInStock">
    <CommandString>
      update WMS_BillMaster set BillDate=@BillDate, AreaCode=@AreaCode,BillTypeCode=@BillTypeCode,FactoryID=@FactoryID,Memo=@Memo,Updater=@Updater,UpdateDate=getdate() where {0}
    </CommandString>
  </Command>
  <Command ID="InsertInStockDetail">
    <CommandString>
      insert into WMS_BillDetail(BillID,RowID,ProductCode,Quantity,Memo)
      values(@BillID,@RowID,@ProductCode,@Quantity,@Memo)
    </CommandString>
  </Command>
  <Command ID="SpInstockTask">
    <CommandString>
      Sp_InstockTask
    </CommandString>
  </Command>
  <Command ID="SpCancelInstockTask">
    <CommandString>
      Sp_InstockCancelTask
    </CommandString>
  </Command>

  <!--出库单-->
  <Command ID="InsertOutStockBill">
    <CommandString>
      insert into WMS_BillMaster(BillID,BillDate,BillTypeCode,AreaCode,TrainTypeCode,TrainNo,AxieLocation,Xc,Ccnz,Ccwz,Fccnz,Fccwz,Memo,Creator,CreateDate,Updater,UpdateDate)
      values(@BillID,@BillDate,@BillTypeCode,@AreaCode,@TrainTypeCode,@TrainNo,@AxieLocation,@Xc,@Ccnz,@Ccwz,@Fccnz,@Fccwz,@Memo,@Creator,getdate(),@Updater,getdate())
    </CommandString>
  </Command>
  <Command ID="UpdateOutStock">
    <CommandString>
      update WMS_BillMaster set BillDate=@BillDate, AreaCode=@AreaCode,BillTypeCode=@BillTypeCode,TrainTypeCode=@TrainTypeCode,TrainNo=@TrainNo,
      AxieLocation=@AxieLocation,Xc=@Xc,Ccnz=@Ccnz,Ccwz=@Ccwz,Fccnz=@Fccnz,Fccwz=@Fccwz,Memo=@Memo,Updater=@Updater,UpdateDate=getdate() where {0}
    </CommandString>
  </Command>
  <Command ID="InsertOutStockDetail">
    <CommandString>
      insert into WMS_BillDetail(BillID,RowID,ProductCode,Quantity,Memo)
      values(@BillID,@RowID,@ProductCode,@Quantity,@Memo)
    </CommandString>
  </Command>
  <Command ID="SpOutstockTask">
    <CommandString>
      Sp_OutstockTask
    </CommandString>
  </Command>
  <Command ID="SpCancelOutstockTask">
    <CommandString>
      Sp_OutstockCancelTask
    </CommandString>
  </Command>

  <Command ID="SelectProductQty">
    <CommandString>
      select ProductCode,(InstockQty-isnull((select SUM(UnStockQty) from View_ProductQty  where billid!=@BillID and  ProductCode=tmp.ProductCode ),0)) as StockQty from View_ProductQTy tmp
      where ProductCode=@ProductCode
    </CommandString>
  </Command>
  
  <!--移库单-->

  <Command ID="InsertMoveStockBill">
    <CommandString>
      insert into WMS_BillMaster(BillID,BillDate,AreaCode,BillTypeCode,Memo,Creator,CreateDate,Updater,UpdateDate)
      values(@BillID,@BillDate,@AreaCode,@BillTypeCode,@Memo,@Creator,getdate(),@Updater,getdate())
    </CommandString>
  </Command>
  <Command ID="UpdateMoveStock">
    <CommandString>
      update WMS_BillMaster set BillDate=@BillDate, AreaCode=@AreaCode,Memo=@Memo,Updater=@Updater,UpdateDate=getdate() where {0}
    </CommandString>
  </Command>
  <Command ID="InsertMoveStockDetail">
    <CommandString>
      insert into WMS_BillDetail(BillID,RowID,ProductCode,Quantity,CellCode,NewCellCode,Memo)
      values(@BillID,@RowID,@ProductCode,@Quantity,@CellCode,@NewCellCode,@Memo)
    </CommandString>
  </Command>
  <Command ID="SpMoveStockTask">
    <CommandString>
      Sp_MovestockTask
    </CommandString>
  </Command>
  <Command ID="SpCancelMoveStockTask">
    <CommandString>
      Sp_MovestockCancelTask
    </CommandString>
  </Command>

  <Command ID="UpdateMoveCellLock">
    <CommandString>
      update CMD_Cell set IsLock=@Lock from CMD_Cell cell inner join WMS_BillDetail sub on cell.CellCode=sub.NewCellCode
      where {0}
    </CommandString>
  </Command>

  <Command ID="UpdateCellLock">
    <CommandString>
      update CMD_Cell set IsLock=@Lock from CMD_Cell cell inner join WMS_BillDetail sub on cell.CellCode=sub.CellCode
      where {0}
    </CommandString>
  </Command>
  




</SqlCommand>